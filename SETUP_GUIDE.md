# 🤖 Astra Discord Bot - Complete Setup Guide

## 🚀 Quick Fix for "Integration requires code grant" Error

### The Problem
When trying to add your bot to Discord servers, you see: **"Integration requires code grant"**

### The Solution (3 Simple Steps)

#### 1. 🔧 Fix Discord Developer Portal Settings

Go to [Discord Developer Portal](https://discord.com/developers/applications):

1. **Select your bot application**
2. **OAuth2 → General tab:**
   - ❌ **DISABLE** "Require OAuth2 Code Grant"
   - ✅ **ENABLE** "In-app Authorization"
3. **Bot tab:**
   - ✅ **ENABLE** "Public Bot"  
   - ❌ **DISABLE** "Require OAuth2 Code Grant"
   - ✅ **ENABLE** "Message Content Intent" (recommended)
4. **💾 Save all changes**

#### 2. 🔗 Get Your Invitation URL

Run this command to get the correct invitation URL:

```bash
python get_bot_info.py
```

Or manually create it:
```
https://discord.com/api/oauth2/authorize?client_id=YOUR_BOT_CLIENT_ID&permissions=1099511627775&scope=bot%20applications.commands
```

**Replace `YOUR_BOT_CLIENT_ID` with your actual bot's Client ID**

#### 3. ✅ Test the Fix

1. Copy the invitation URL
2. Paste in browser (try incognito mode if still having issues)
3. Select a server you manage
4. You should **NOT** see the "code grant" error anymore!
5. Complete the authorization
6. Test with `/ping` command

---

## 🎯 What Was Wrong?

The error happens when Discord thinks your bot needs a complex "authorization code flow" instead of the simple bot invitation process. This is caused by:

- ✅ **Correct:** `scope=bot applications.commands` 
- ❌ **Wrong:** `scope=applications.commands` (missing 'bot')
- ❌ **Wrong:** "Require OAuth2 Code Grant" enabled

---

## 🛠️ Advanced Setup

### Multiple Permission Levels

After fixing the main issue, you can use different permission levels:

- **Full Permissions:** `1099511627775` (all features)
- **Recommended:** `378762947798` (balanced)
- **Minimal:** `379968` (basic only)

### In-Bot Commands

Once your bot is running, users can use:

- `/invite` - Interactive invitation link generator
- `/setup` - Server setup guide for administrators  
- `/diagnostics` - Comprehensive bot health check

### Test Everything Works

Run the comprehensive test suite:

```bash
python test_integration.py
```

This validates:
- ✅ URL format and parameters
- ✅ Permission calculations
- ✅ Configuration loading
- ✅ File structure
- ✅ Import dependencies
- ✅ Bot connection (if token provided)

---

## 🆘 Still Having Issues?

### Common Problems & Solutions

1. **Still seeing "code grant" error:**
   - Double-check Developer Portal settings
   - Wait 5-10 minutes for changes to propagate
   - Try incognito/private browser window
   - Clear browser cache

2. **Bot not appearing in server:**
   - Verify you have "Manage Server" permission
   - Check the invitation URL is correct
   - Ensure bot is actually online

3. **Commands not working:**
   - Run `/ping` to test basic functionality
   - Check bot has necessary permissions
   - Use `/diagnostics` to identify issues

### Get Help

- 📋 Use `/diagnostics` for automated troubleshooting
- 🧪 Run `python test_integration.py` for comprehensive testing
- 📖 Check this setup guide
- 🔍 Review Discord's bot documentation

---

## 🎉 Success!

If you followed these steps, your Astra bot should now:

- ✅ Install properly on Discord servers
- ✅ Have working slash commands
- ✅ Display NASA space images correctly
- ✅ Pass all diagnostic tests
- ✅ Be ready for production use

**The "Integration requires code grant" error should be completely resolved!**

---

*Generated by Astra v2.0.0 - Ready to explore the cosmic frontier! 🌌*
